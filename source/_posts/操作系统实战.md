---
title: 操作系统实战
date: 2021-05-20
updated: 2021-05-31
tags: [OS]
categories: 实战项目
references:
  - title: 操作系统实战45讲
    url: https://time.geekbang.org/column/intro/100078401
  - title: 深度探索嵌入式操作系统
    url: https://book.douban.com/subject/26643785/
---

> 操作系统是计算机王国中一切法则的制定者，它掌管着硬件软件等一切资源，并负责处理多种基本事务（内存管理、资源配置、I/O 设备、网络通信等），只要我们使用计算机，就会和操作系统打交道，接受它的审核与反馈。很多热门的技术话题的背后都离不开操作系统。操作系统实战45讲由彭东老师授课，从0到1搞懂操作系统到底是如何运作的，实现一个属于自己的基于x86平台的支持多进程的操作系统内核，以下为所记课堂笔记，可供参考。

<!--more-->

### 从代码到机器运行

#### 从零出发

- 操作系统是所有软件的基础，所有上层软件都要依赖于操作系统提供的各种机制才能运行

- 在真正打造操作系统前，首先需要了解程序如何运行的所有细节和原理

- Ken Thompson用B语言和汇编语言在PDP-7的机器上开发出了UNiplexed Information and Computing System（UNICS），即UNIX的雏形

- Dennis Ritchie和Ken Thompson共同创造了大名鼎鼎的C语言，并用C语言写出了UNIX和后来的类UNIX体系的几十种操作系统，也写出了对后世影响深远的第一版`"Hello World"`

  ```c
  #include "stdio.h"
  int main(int argc, char const *argv[])
  {
    printf("Hello World!\n");
    return 0;
  }
  ```

- 计算机硬件无法直接运行C语言文本程序代码，需要C语言编译器把代码编译成具体硬件平台的二进制代码，再由具体操作系统建立进程，把二进制文件装进其进程的内存空间中，才能运行

#### 程序编译过程

- 使用命令`gcc HelloWorld.c -o HelloWorld`或者`gcc ./HelloWorld.c -o ./HelloWorld` 就可以编译`"Hello World"`代码
- GCC是完成编译工作的驱动程序，它会根据编译流程分别调用预处理程序、编译程序、汇编程序、链接程序来完成具体工作
- 手动控制编译流程
  - `gcc HelloWorld.c -E -o  HelloWorld.i`：预处理，加入头文件，替换宏
  - `gcc HelloWorld.c -s -c HelloWorld.s`：编译，包含预处理，将C程序转换成汇编程序
  - `gcc HelloWorld.c -c HelloWorld.o`：汇编，包含预处理和编译，将汇编程序转换成可链接的二进制程序
  - `gcc HelloWorld.c -o HelloWorld`：链接，包含以上所有操作，将可链接的二进制程序和其它别的库链接在一起，形成可执行的程序文件

#### 程序装载执行

- 阿兰图灵提出一个抽象的模型，图灵机：一条无限长的纸带，纸带上有无限个小格子，小格子中写有相关的信息，纸带上有一个读头，读头能根据纸带小格子里的信息做相关的操作并能来回移动
- 冯诺依曼提出电子计算机使用二进制数制系统和储存程序，并按照程序顺序执行
- 冯诺依曼体系结构中计算机必须具备五大基本组成部件
  1. 装载数据和程序的输入设备
  2. 记住程序和数据的存储器
  3. 完成数据加工处理的运算器
  4. 控制程序执行的控制器
  5. 显示处理结果的输出设备
- 现代电子计算机通过内存中的信息（指令和数据）做出相应的操作，并通过内存地址的变化，达到程序读取数据，控制程序流程（顺序、跳转对应该图灵机的读头来回移动）的功能

