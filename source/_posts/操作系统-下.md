---
title: 操作系统（下）
date: 2021-09-11
updated: 2021-11-31
tags: [Operating System]
categories: 计算机专业
---

>  操作系统（OS）是管理和控制计算机硬件与软件资源，是计算机上直接运行的最基本的系统软件，任何其他软件都必须在操作系统的支持下才能运行。操作系统是用户和计算机的接口，同时也是计算机硬件和其他软件的接口。操作系统的功能包括管理计算机系统的硬件、软件及数据资源，控制程序运行，提供人机交互界面，为其它应用软件提供支持等。我选择的课程是苏州大学的[国家精品课](https://www.icourse163.org/course/SUDA-1001752241)和汤子瀛版教材，以下为所记课堂笔记下半部分，包含内存管理、文件管理和设备管理的知识点，可供参考。上半部分笔记请访问[操作系统（上）](/操作系统-上)

<!--more-->

### 内存管理

#### 内存管理概述

- 内存管理的功能是为多道程序的运行提供良好的环境
  - 内存的分配和回收：记住内存空间的使用情况、实施内存的分配、回收系统或用户释放的内存空间
  - 地址变换：将逻辑地址转换为物理地址
  - 扩充内存：虚拟存储技术或其他自动覆盖技术
  - 存储保护：由硬件和软件配合完成
- 应用程序的编译、链接与装入
  1. 经过编译程序将源代码编译为若干个目标模块
  2. 通过链接程序将编译好的目标模块以及所需的库函数链接在一起，形成完整的装入模块
  3. 通过装入程序将这些装入模块装入内存并执行
- 源程序（名地址）-> 目标程序（逻辑地址）-> 可执行程序（物理地址）
  - 对程序设计者来说，数据的存放地址由数据名称决定，称为名地址或符号名地址，即为源程序的地址空间
  - 当链接程序将多个模块链接为装入模块时，链接程序会按照各个模块的相对地址，将其地址构成统一的从0号单元开始编址的相对地址
  - 当装入程序将可执行代码装入内存时，程序的逻辑地址与程序存在内存的实际地址，通常不同这就需要通过地址转换将逻辑地址转为物理地址，这个过程叫重定位
- 程序链接的 3 种方式
  - 静态链接：在程序运行之前，先将各目标模块及所需的库函数连接成一个完整的可执行程序（装入模块），之后不再拆开
  - 装入时动态链接：将各目标模块装入内存时，边装入边链接的链接方式
  - 运行时动态链接：在程序执行中需要该目标模块时，才对它进行链接。其优点是物理地址便于修改和更新，便于实现对目标模块的共享
- 程序装入的 3 种方式
  - 绝对装入：在编译时就知道程序将要驻留在内存的物理地址，编译程序产生含有物理地址的目标代码
  - 可重定位装入：根据内存当前情况将装入模块装入到内存的适当位置，地址变换通常在装入时一次完成，容易实现，无需增加硬件地址变换机构
  - 动态运行装入：允许程序运行时在内存中移动位置，在程序执行过程中，每当访问到相应指令或数据时，才将要访问的程序或数据的相对地址转换为物理地址，可以将程序分配到不连续的存储区中
- 在重定位中通常会设一个重定位寄存器，用来存放进程分配的内存空间的地址（基址寄存器）
  - 当 CPU 需要访问内存时，将逻辑地址转换为物理地址
  - 物理地址 = 基址计算器内容 + 逻辑地址
- 逻辑地址和物理地址
  - 逻辑地址是指由程序产生的与段相关的偏移部分地址（与页无关，因为只有段对用户可见）
  - 物理地址是指出现在 CPU 外部地址总线上的寻址物理内存的地址信号，是逻辑地址变换后的最终结果地址，物理地址空间是指内存中物理地址单元的集合
  - 从逻辑地址到物理地址的转换过程由硬件自动完成，这个转换过程叫做地址重定位
- 内存保护
  1. 界限寄存器方法
     - 上、下界寄存器方法：分别存放作业的结束地址和开始地址
     - 基址和限长寄存器方法
  2. 存储保护键方法：给每个存储块分配一个单独的保护键

#### 交换与覆盖

- 覆盖技术，就是把一个大的程序划分为一系列覆盖，每个覆盖是一个相对独立的程序单位
  - 把程序执行时并不要求同时装入内存的复盖组成一组，称为覆盖段
  - 将这个覆盖段分配到同一存储区域，这个存储区域称为覆盖区
  - 覆盖区与覆盖段一一对应
  - 覆盖技术只能覆盖与覆盖程序段无关的程序段
  - 为了使一个覆盖区能被相应覆盖段中每个覆盖在不同时刻共享，其大小应由覆盖段中最大覆盖来确定
  - 覆盖技术的特点是打破了必须将一个进程的全部信息装入主存后才能运行的限制，但当同时执行程序的代码量超过主存时，程序仍然不能运行
- 交换技术就是把暂时不用的某个程序及数据部分从内存移到外存中，以便腾出必要的内存空间，或把指定的程序或数据从外存读到相应的内存中，并将控制权转让给他，让其在系统上运行的一种内存扩充技术
  - 处理器三级调度中的中级调度就是采用了交换技术
  - 与覆盖技术相比，交换技术不要求程序员给出程序段之间的覆盖结构，且交换主要是在进程或作业之间进行，而覆盖主要在同一个作业或进程中进行
  - 交换进程由换出和换入两个过程组成
  - 交换技术的特点是打破了一个程序一旦进入主存便一直运行到结束的限制，但运行的进程大小仍然受实际主存的限制
  - 交换需要备份存储
  - 影响交换时间的因素主要是转移时间
  - 如果换出进程，必须确保该进程完全空闲
  - 交换空间通常作为磁盘的一整块，且独立于文件系统
  - 交换通常在有许多进程运行，且内存空间紧张时开始启动，而在系统负荷减轻时暂停

#### 连续分配管理方式

- 内部碎片和外部碎片
  - 内部碎片是指已经分配给作业，但不能被利用的内部空间
  - 外部碎片是指系统中还没有分配给作业，但由于碎片太小而无法分配给申请内存空间的新进程的存储块
- 单一连续分配：将内存分为两个连续存储区域，其中一个存储区域固定的分配给操作系统使用，通常放在内存低地址部分，另一个存储区域给用户作业使用
  - 通常用户作业只占用所有分配空间的一部分，剩下一部分实际上浪费掉了
  - 单一连续分配方式采用静态分配，适合单道程序，可采用覆盖技术
  - 作业一旦进入内存，就要等到其结束后才能释放内存，因此这种分配方式不支持虚拟存储器的实现，无法实现多道程序共享主存
  - 单一连续分配会产生内部碎片
- 固定分区分配：将内存空间划分为若干个固定大小的分区，每个分区中可以装入一道程序
  - 分区的大小可以不等，但事先必须确定，在运行时不能改变
  - 当有空闲分区时，便从后备队列中选择一个适当大小的作业装入运行
  - 固定分区分配中程序通常采用静态重定位方式装入内存
  - 固定分区分配的优点是可用于多道程序系统最简单的存储分配，缺点是不能实现多进程共享一个主存区，利用率较低，会产生内部碎片
- 动态分区分配：作业进入主存时，根据作业的大小动态的建立分区，并使分区的大小正好满足作业的需要，因此系统中分区的大小是可变的，分区数目也是可变的
  - 空闲分区表、空闲分区链
  - 首次适应算法（FF）、下次适应算法（NF）、最佳适应算法（BF）、最差适应算法（WF）
  - 分区回收
  - 分区分配的动态管理：拼接技术、动态重定位分区分配技术
- 动态分区分配的优缺点
  - 优点：实现了多道程序共用主存、管理方案相对简单、实现存储保护的手段比较简单
  - 缺点：主存利用不够充分，存在外部碎片、无法实现多进程共享存储器信息、无法实现主存的扩充，进程地址空间受实际存储空间的限制

#### 非连续分配管理方式

- 非连续分配允许一个程序分散地装入到不相邻的内存分区中
- 非连续分配管理方式根据分区大小是否固定为分页存储管理方式和分段存储管理方式
- 分页存储管理方式根据运行作业时是否需要把作业的所有页都装入内存才能运行而分为基本分页存储管理方式和请求分页存储管理方式
- 基本分页存储管理方式（物理单位）
  - 分页原理：用户作业的地址空间被划分成若干个大小相等的区域，称为页或页面
  - 将主存的存储空间分成与页面大小相等的区域，称为块或物理块
  - 在为作业分配存储空间时，总是以块为单位来分配，可以将作业中的任意一页放到主存的任意一块中
  - 主存中与页面大小相等的物理块也可称为页框
  - 为了将逻辑地址上连续的页号映射到物理内存中后成为离散分布的多个物理块，需要将每个页面和每个物理块一一对应，这种映射关系体现在页表中
  - 每个页表项由页号和块号组成
  - 基本地址变换机构：页表寄存器（PTR）
  - 具有快表（TLB）的地址的地址变换机构：具有并行查找功能的高度缓冲存储器
  - 两级页表和多级页表
- 基本分页存储管理方式优缺点
  - 优点：内存利用率高、实现了离散分配、便于存储访问控制、无外部碎片
  - 缺点：需要硬件支持（快表）、内存访问效率下降、共享困难、内部碎片
- 基本分段存储管理方式（逻辑单位）
  - 逻辑地址结构由段号 S 和段内位移 W（段内偏移量）组成
  - 段的长度不定
  - 作业空间地址是二维的
  - 段表及地址变换过程
- 基本分段存储管理方式优缺点
  - 优点：便于程序模块化处理和处理变换的数据结构、便于动态链接和共享、无内部碎片
  - 缺点：与分页类似，需要硬件支持、为满足分段的动态增长和减少外部碎片，要采用拼接手段、分段的最大尺寸受到主存可用空间的限制、有外部碎片

#### 虚拟内存的基本概念

- 

