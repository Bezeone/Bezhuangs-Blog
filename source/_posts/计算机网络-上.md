---
title: 计算机网络（上）
date: 2021-06-10
updated: 2021-08-06
tags: []
categories: 计算机专业
mathjax: true
---

> 计算机网络是计算机专业必修的重要课程之一，与现实世界结合得相当紧密，也是考研408计算机学科专业基础综合考试中的一门课程。计算机网络学习的核心内容就是网络协议的学习。网络协议是为计算机网络中进行数据交换而建立的规则、标准或者说是约定的集合。我选择的课程是哈工大的[国家精品课](https://www.icourse163.org/learn/HIT-154005)和谢希仁版教材，以下为所记课堂笔记上半部分，包含计算机网络体系结构、物理层和数据链路层的知识点，可供参考。下半部分笔记请访问[计算机网络（下）](/计算机网络-下)

<!--more-->

###  计算机网络体系结构

#### 计算机网络概述

- 计算机网络就是一些互联的、自治的计算机系统的集合。
- 自治计算机就是能够进行自我管理、配置和维护的计算机。
- 计算机网络包括硬件、软件、协议三大部分。
  - 硬件由主机、通信处理机、通信线路和交换设备组成。
- 从工作方式上看，计算机网络可分为边缘部分和核心部分。
- 从功能组成上看，计算机网络由通信子网和资源子网两部分构成。
  - 通信子网包括物理层、数据链路层和网络层。
- 数据通信是计算机网络最基本和最重要的功能。
- 资源共享包括数据资源、软件资源以及硬件资源。

#### 计算机网络体系结构与参考模型

- 实体是任何可发送或接收信息的硬件或软件进程。
- 对等层是不同机器上的同一层，对等实体是同一层上的实体。
- 协议是控制2个对等实体进行通信的规则。
- 接口又称服务访问点，没有接口就不能提供服务。从物理层开始，每一层都向上层提供服务访问点。
- 服务数据单元 SDU，协议控制信息 PCI，接口控制信息 ICI。
- 协议数据单元 PDU，表示的是同等层对等实体间传送的数据单元。`n-SDU`+`n-PCI`=`n-PDU`，`n-PDU`=`(n-1)-SDU`
- 接口数据单元 IDU，表示的是在相邻层接口间传送的数据单元。`n-SDU`+`n-ICI`=`n-IDU`
- 服务至下层为相邻上层提供的功能调用。只有那些能够被高一层实体看得见的功能才成为服务。
- 面向连接的服务（TCP），面向无连接的服务（IP和UDP）。
- 第n层的实体使用第n-1层的服务，向第n+1层提供本层的服务。该服务是第n层及其下各层所提供的服务的总和。
- 最高层向用户提供服务，下一层提供服务的实现细节对上一层透明。
- OSI参考模型具有7层结构，而TCP/IP模型仅有4层结构。
  - 应用层（用户对用户），提供系统与用户的接口。文件传输、访问和管理、电子邮件服务。FTP，smtp，pop3，HTTP。
  - 传输层（应用对应用，进程对进程），负责主机中2个进程之间的通信。为端到端连接提供可靠的运输服务、流量控制、差错控制、服务质量管理。TCP、udp、ARQ。
  - 网络层（主机对主机），为传输层提供服务、组包和拆包、路由选择、拥塞控制。ICMP、Arp、RARP、IP、IGMP。
  - 网络接口层 = 数据链路层 + 物理层
  - 数据链路层，将网络层传下来的IP数据报组装成帧数。PPP、HDLC。
  - 物理层，为数据端设备提供传送数据通路，传输比特流。 
  - 应用层 = 应用层 + 表示层 + 会话层
  - 会话层的主要功能是在2个节点间建立维护和释放面向用户的连接，并对会话进行管理和控制，保证会话数据可靠传送。
  - 表示层负责处理在2个内部数据表示结构不同的通信系统间交换信息的表示格式，数据压缩及解压。
  - TCP/IP模型没有明确区分服务、接口、协议，且网络层仅有无连接。OSI参考模型网络层有连接和无连接，但传输层仅面向连接。

#### 计算机网络性能指标

- 总时延 = 发送时延 + 传播时延 + 处理时延 + 排队时延
- 数据传输率是由总时延决定的，而带宽仅决定了发送时延。
- 发送时延 = 数据帧长度（bit）/ 发送速率（bit/s）
- 传播时延 = 信道长度（m）/ 电磁波在信道上的传播速度（m/s）
- 时延带宽积 = 传播时延 × 带宽
- 利用率包括信道利用率和网络利用率（全网络的信道利用率的加权平均值）。
- 1 MB/s = 8 Mbit/s

### 物理层

#### 通信基础

- 数据是传送信息的实体。而信号是数据的电气或电磁的表现。
- 基带对应数字信号，宽带对应模拟信号。
- 数据传输方式分为串行传输和并行传输。通信方式分为同步通信和异步通信。通信模式分为单向通信、双向交替通信、双向同时通信。
- 波特率（码元传输速率）表示单位时间内数字通信系统所传输的码元个数，单位波特（Baud）。
- 比特率（信息传输速率）表示单位时间内通信数字系统所传输的二进制码元个数，单位比特数（bit/s）。
- 每比特只能表示两种信号变化，可看成二进制。
- 带宽表示在单位时间内从网络中的某一点到另一点所能通过的最高数据率（网络的通信线路所能传送数据的能力）。单位比特每秒（bit/s）。
- 在通信领域，带宽是指信号最高频率与最低频率之差（Hz）。因此将模拟信号转换成数字信号时，采样频率必须大于等于最大频率f的2倍。
- 奈奎斯特定理给出了在无噪声情况下码元的最大传输速率。f表示理想低通信道的带宽。N表示每个码元的离散电平的数目。
  - $C_{\max }=f_1*\log _{2}N=2f*\log _{2}N$
- 信噪比是信号的平均功率和噪声的平均功率之比。S/N（dB）‘
- 香农公式给出了信号传输速率的极限。W为信道的带宽。
  - $C_{\max }=W*\log _{2}\left( 1+\dfrac{S}{N}\right)$
- 要使信息的极限传输速率提高，就必须提高信道的带宽或信道中的信噪比。实际信道的传输速率要比极限速率低不少。
- 模拟数据和数字数据都可以转化成模拟信号（调制）或数字信号（编码）。
- 数据传输方式包括电路交换、报文交换和分组交换。
  - 电路交换一定面向连接。通信时延小、实时性强、有序传输，但信道利用率低、缺乏统一标准、灵活性差。
  - 报文交换，报文携带有目的地址、源地址。无需建立连接、动态分配线路，但报文大小没限制，要求网络节点需要有较大的存储缓存空间。
  - 分组交换仍采用存储转发传输方式。将一个长报文分割成若干个较短的分组。加速传输、简化存储管理、减少出错概率和重发数据量，但存在传输时延、可能出现失序、丢失或重复分组现象。
  - TCP可以向应用层提供面向连接的服务，而UDP在传输层是无连接的。
  - 分组交换可分为面向连接的虚电路方式和面向无连接的数据报方式，二者都由网络层提供。
  - 数据报无需建立连接、提高吞吐量、对故障适应力强，每个分组包含完整的源地址和目的地址，可靠通信由用户主机来保证。
  - 虚电路时延小、按序到达，每个分组包含一个虚电路号，可靠通信由网络来保证。

#### 传输介质

- 传输介质分为导向性传输介质和非导向性传输介质。
  - 导向性传输介质包含双绞线、同轴电缆和光纤。
  - 双绞线分为无屏蔽双绞线和屏蔽双绞线。
  - 同轴电缆分为基带同轴电缆（50Ω）和宽带同轴电缆（75Ω）。
  - 光纤分为单模光纤（远距离）和多模光纤（近距离）。
  - 非导向性传输介质有短波、微波、红外线与可见光等。
- 传输介质并不是物理层，在传输介质中传输的是信号。物理层主要的功能就是确定与传输介质的接口有关的一些特性，即物理层接口的特性，如机械特性、电气特性、功能特性、规程特性。
- 物理层设备主要包含中继器和集线器。放大器放大的是模拟信号，中继器放大的是数字信号。
- 集线器实际就是一个多端口的中继器（Hub）。集线器在一个时钟周期内只能传输一组信息。集线器不能隔离冲突域。
- 通过中继器或集线器连接起来的几个网段仍然是一个局域网。使用集线器的以太网在逻辑上仍是一个总线网，各工作站使用CSMA/CD协议，共享逻辑上的总线。

### 数据链路层

#### 数据链路层的功能

- 数据链路层在物理层所提供的服务的基础上向网络层提供服务，分为无确认的无连接服务、有确认的无连接服务和有确认的有连接服务。
- 数据链路层的主要功能分为链路管理、帧同步、差错控制、透明传输。
- 当2个主机互相传送信息时，网络层的分组。必须封装成帧，并以帧的格式进行传送。即将一段数据的前后分别添加首部和尾部形成帧，首部和尾部中有很多控制信息，如帧定界。

#### 组帧

- 组帧方法分为字符计数法、字节填充的首尾界符法、比特填充的首尾标志法、物理编码违例法。
- 在网络中以帧为最小单位进行传输，所以组帧既要有首部又要加尾部，确定接收端清楚该帧在一串比特流中从哪里开始、到哪里结束。
- 字符计数法用一个特殊的字符表示一帧的开始，用一个计数字段表明该帧包含的字节数，计数字段提供的字节数包含自身所占的一个字节。
- 首尾界符法选定2个字符（SOH/EOT）作为每一个帧的开始和结束。字符填充的首尾界符法是将数据中可能出现的控制字符`SOH`和`EOT`在接收端不解释为控制字符。
- 比特填充的首尾标志法使用`01111110`作为帧的开始和结束标志。零比特填充法每有5个连续的`1`马上在其后插入`0`，接收方每收到5个连续的`1`自动删除后面紧跟的`0`恢复原始数据。
- 物理编码违例法利用物理介质上的编码的违法标志来区分帧的开始和结束，例如在曼彻斯特编码中高-高和低-低电平的编码方式是无效的，用来作为帧的起始和结束标志。

#### 差错控制

- 检错编码分为奇偶校验码和循环冗余码。
  - 奇偶校验码是在信息码后面加1位校验码，分为奇校验和偶校验。奇校验是添加1位校验码后使得整个码字里面`1`的个数是奇数。
  - 循环冗余码（CRC）是在发送端产生一个冗余码，附加在信息位后面一起发送到接收端，接收端收到的信息按发送端形成循冗余码同样的算法进行校验，如果发现错误则通知发送端重发。
  - CRC的本质是模-2除法的余数，采用的除数不同，CRC的类型也就不一样。
  - 循环冗余码具有r检测位的多项式能够检测出所有小于或等于r的突发错误，长度大于r+1的错误逃脱的概率是 $\dfrac{1}{2^{r}}$。
- 常见的纠错编码是海明码，在 k 位信息字段中插入若干位数据用于监督码字里的哪一位数据发生变化，具有一位纠错能力。
  - 确认校验码的位数 r：$2^{r}-1\geq k+r$
  - 校验码$P_i$在编码中的位置为$2^{i-1}$
  - 出错位$e_n$等于所有有关位$M_n$互为异或，求出$P_i$，按序写出海明码
  - 校验海明码：出错位$e_n$等于所有有关位$M_n$互为异或，求出$e_n$
  - 出错位$e_n$对应的十进制数就是出错的位数

#### 流量控制与可靠传输机制

- 流量控制就是要控制发送方发送数据的速率使接收方来得及接收，分为停止-等待流量控制和滑动窗口流量控制。
  - 停止-等待流量控制就是发送方发出一帧，等接收方收到一帧后返回应答信号，再发送下一帧。
  - 滑动窗口流量控制允许一次发送多个帧。在任意时刻发送方都维持一组连续的允许发送的帧的序号，称为发送窗口。同时接收方也维持一组连续的允许接收帧的序号，称为接收窗口。发送端每收到一个帧的确认，发送窗口就向前移动1个帧的位置。
  - 只有在接收窗口向前滑动时，发送窗口才有可能向前滑动。
  - 只要当接收窗口大小为1时，则可保证帧按序接受。
- 端到端的可靠传输就是在传输层使用面向连接的TCP，而不是数据链路层。
- 可靠传输一般使用确认和超时重传两种机制共同完成（ARQ自动请求重发）。
- 可靠传输机制包括停止-等待协议、后退N帧协议和选择重传协议。
  - 停止等待协议就是发送窗口和接收窗口大小均为1。帧一般分为数据帧和确认帧。
  - 后退N帧协议：发送方连续发送若干个数据帧，如果收到接收方的确认帧接着发送数据，如果某个帧出错，接收方只能简单丢弃该帧及后续所有帧。增加吞吐量，但造成一定浪费。
  - 后退N帧协议接收窗口大小=1，$1<发送窗口大小W_{T}\leq 2^{n}-1$。n为对帧编号的比特数。
  - 选择重传（SR）协议：当一帧出错时，后续帧先存入接收方的缓冲区中,同时要求发送方重传出错帧。提高信道利用率但增加缓冲空间。
  - 选择重传协议的接收窗口尺寸和发送窗口尺寸都大于1，以便能一次性接受多个帧。发送窗口的最大尺寸也不能超过序列号范围的一半。当发送窗口等于接收窗口=$2^{n}-1$时达到最大效率。
  - 按序到达的且没有被交付给主机的帧被放在接收缓存里。不按序到达的数据且没有错误的帧放在接收窗口里。不直接给主机，等缺少的帧收到后再一起放到接收缓存。
  
#### 介质访问控制

- 静态分配信道的方法是信道划分介质访问控制。动态分配信道的方法分为随机访问介质访问控制和轮询访问介质访问控制。
- 多路复用技术是在一条介质上同时携带多个传输信号，使多个计算机或终端设备共享信道资源，提高信道的利用率。实现信道划分介质访问控制。
- 信道划分介质访问控制分为频分多路复用、时分多路复用、波分多路复用和码分多路复用。
  - 频分多路复用时如果复用数增加，那么信号的频率带宽增加。
  - 统计时分复用是一种动态的时间分配。
  - 波分多路复用就是光的频分多路复用。
  - 码分多路复用，又称为码分多址（CDMA），既共享信道的频率又共享时间，主要用于无线通信系统。
  - 任意2个站点的码片向量的规格化内积一定为1。任意站点的码片向量与该码片向量自身的规格化内积一定为1。任何站点的码片向量和该码片的反码向量的规格化内积一定为负1。
- 动态划分信道分为随机接入（争用性协议）和受控接入。
  - ALOHA协议：不检测发送数据，一段时间没收到确认即为发送冲突，发生冲突的节点等待一段随机事件后再发送数据。
  - 时分ALOHA：所有节点的时间被划分为间隔相同的时隙，并规定每个节点就会等到下一个时隙到来时才可发送数据。
  - 载波侦听多路访问（CSMA）协议：每个节点发送数据之前，都使用载波侦听技术来判定通信信道是否空闲，在局域网中被广泛的应用。
  - 1-坚持CSMA：监听到信道空闲时，立即发送数据，否则继续监听。
  - p-坚持CSMA：监听到信道空闲时，以概率P发送数据，以概率(1-P)延迟一段时间并重新监听。
  - 非坚持CSMA。监听到信道空闲时，立即发送数据，否则延迟一段随机的时间再重新监听。
  - CSMA/CD协议（带冲突检测的载波侦听多路访问协议）：检测超过发送站点本身发送的载波信号的幅度，由此判断出冲突的存在，并向总线上发一串阻塞信号。
  - CSMA/CD工作流程：先听后发，边听边发，冲突停发，随机重发。
  - CSMACD用于信道使用半双工的网络环境，而对于使用全双工的网络环境，则无需采用这种介质访问控制技术。
  - 争用期（$2\tau$）：以太网端到端的往返时延，又称冲突窗口或碰撞窗口。只有经过争用期还没有检测到冲突，才能肯定这次发送不会发生冲突。
  - 以太网规定最短帧长为64B，凡长度小于64B的都是由于冲突而异常停止的无效帧。以太网端到端的单程时延实际上小于争用期的一半（25.6μs）。
  - 最短有效帧长和最远2个站的距离及传输速率成正比。
  - 截断二进制指数类型退避算法：发生碰撞的站在停止发送数据后要推迟一个随机时间才能发送数据，基本退避时间一般取争用期（$2\tau$），重传需要推迟的平均时间随重传次数的增大而增大。
  - CSMA/CA协议主要用在无线局域网中，在CSMA的基础上增加了冲突避免的功能。
  - CSMA/CA协议要对正确接收到的数据帧进行确认。
- 轮询访问介质访问控制主要用于在令牌环局域网中。典型的轮询访问介质访问控制协议就是令牌传递协议。

#### 局域网

- 局域网（local area network，LAN）是指一个较小范围内的多台计算机或其他通信设备通过双绞线、同轴电缆等连接介质互联起来，以达到资源和信息共享目的的互联网络。
  - 局域网有较高的数据率、较低的时延和较小的误码率，具有广播功能，便于系统的扩展和演变。
  - 局域网的主要技术要素包括网络拓扑结构传输介质与介质访问控制方法。局域网的主要拓扑结构包括星型网环形网总线型网和树型网（星型网和总线型网的结合）。双绞线为局域网的主流传输介质。
  - 局域网的主要介质访问控制方法包括CSMA/CD、令牌总线和令牌环。前两种作用于总线型网，令牌环作用于环形网。
  - 局域网对应OSI参考模型中的数据链路层和物理层，并将数据链路层拆分为2个子层，逻辑链路控制（LLC）子层和媒体接入控制（MAC）子层。
- 以太网采用总线拓扑结构。所有计算机都共享一条总线信息，以广播方式发送，使用CSMACD技术对总线进行访问控制。
  - 以太网采用无连接的工作方式，不对发送的数据帧进行编号，也不要求对发送方发送确认。以太网提供的服务是不可靠服务，所以有重传机制，且差错纠正由传输层的TCP完成。
  - 数据传输速率达到或超过100Mbit/s的以太网称为高速以太网。100base-T以太网称为快速以太网。吉比特以太网成为千兆以太网,允许在全双工和半双工两种方式工作。在半双工方式下工作时必须使用CSMA/CD协议进行冲突检测。
- 无线局域网分为有固定基础设施和无固定基础设施两类。IEEE802.11规定有固定基础设施的无线局域网的最小构建为基本服务集（BSS），BSS中的基站称为接入点（AP）。
  - 基本服务集可以是孤立的，也可以通过接入点连接到一个主干分配系统（DS）构成扩展的服务器（ESS），ESS还可通过门桥（portal）设备为无线用户提供到非IEEE802.11无线局域网的接入。
  - IEEE802.11标准中的物理层有跳频扩频（FHSS）、直接序列扩频（DSS）、红外线（IR）3种实现方法。
  - IEEE802.11标准中的MAC层在物理层上，包括2个子层，从下往上依次为分布协调功能（DCF）子层和点协调功能（PCF）子层。在带有碰撞避免功能的CSMA/CA协议的基础上增加确认机制。
- 广域网是覆盖范围很广的长距离网络，由一些节点交换机以及连接这些交换机的链路组成。节点交换机完成分组存储转发的功能。
  - 广域网是通过交换机连接多个局域网组成，因特网是由广域网和局域网共同通过路由器相连。
  - 局域网使用的协议主要在数据链路层，而广域网使用的协议主要在网络层。
  - 广域网的路由选择协议负责搜索分组从某个节点到目的节点的最佳传输路由，以便构成路由表，从路由表再构造出转发分组的转发表，分组是通过转发表进行转发的。
- 点对点协议（PPP）由一个将IP数据报封装到串行链路的方法、一个用于建立配置和测试数据链路连接的链路控制协议（LCP）和一套用来建立和配置不同的网络层协议的网络控制协议（NCP），其中每个协议支持不同的网络层协议。
  - PPP是一个面向字节的协议，不需要纠错（只负责检错）、流量控制（由TCP负责）、序号（不可靠的传输协议）、多点线路，只支持全双工链路。
- 高级数据链路控制（HDLC）协议是ISO制定的面向比特的数据链路控制协议，可适用于链路的非平衡配置（一个主站控制整个链路的工作）和平衡配置（链路两端2个站都是复合站）。
  - PPP帧比HDLC协议帧多一个2字节的协议字段，当协议字段值为Ox0021时表示信息字段是IP数据报。
  - PPP不使用序号和确认机制，只保证无差错接收（通过硬件进行循环冗余码校验），HDLC协议的信息帧使用了编号和确认机制。

#### 数据链路层设备

- 在物理层拓展局域网使用中继器和集线器扩大冲突域，但总吞吐量未提高，且不能互联使用不同以太网技术的局域网。
- 在数据链路层扩展局域网使用网桥，具有过滤帧的功能。网桥至少有2个端口，每一个端口与一个网段相连。
  - 网桥从一个端口接收一个帧，先暂存到缓存中，若未出现差错，且发往目的站MAC地址属于另一网段，则通过查找转发表将该帧从对应端口发出。
  - 网桥过滤通信量、扩大物理范围、提高可靠性、可互连不同物理层、不同MAC子层和不同速率的以太网，但存储转发增加时延，且在MAC层并没有流量控制功能，用户过多会因传播过多的广播信息而产生网络拥塞（广播风暴）。
  - 网桥包括透明网桥（选择的不是最佳路由）和源选径网桥（选择的是最佳路由）。最佳路由并不一定是经过路由器最少的路由，也可以是发送帧往返时间最短的路由（实现负载平衡）。
- 局域网交换机实质上是工作在数据链路层的多端口网桥。局域网交换机的每个端口都直接与主机或集线器相连，并且一般都工作在全双工方式。
  - 交换机总容量 = 端口数×每个端口带宽（半双工）or 端口数×每个端口带宽×2（全双工）
  - 交换机分为直通式交换和存储转发式交换，工作原理与网桥类似。
  - 网桥的端口一般连接到局域网的网段，而以太网交换机的每个端口一般都直接与主机相连，也可连接到Hub。
- 一块网卡发出一个广播，能收到这个广播的所有网卡集合为一个广播域。通常情况下，一个网段就是一个冲突域，一个局域网就是一个广播域。

