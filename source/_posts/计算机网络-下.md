---
title: 计算机网络（下）
date: 2021-08-30
updated: 2021-10-26
tags: []
references: 
  - title: 计算机网络复习笔记
    url: https://blog.csdn.net/server643/article/details/118392247
categories: 计算机专业
mathjax: true
---

> 计算机网络是计算机专业必修的重要课程之一，与现实世界结合得相当紧密，也是考研408计算机学科专业基础综合考试中的一门课程。计算机网络学习的核心内容就是网络协议的学习。网络协议是为计算机网络中进行数据交换而建立的规则、标准或者说是约定的集合。我选择的课程是哈工大的[国家精品课](https://www.icourse163.org/learn/HIT-154005)和谢希仁版教材，以下为所记课堂笔记下半部分，包含网络层、传输层和应用层的知识点，可供参考。上半部分笔记请访问[计算机网络（上）](/计算机网络-上)

<!--more-->

### 网络层

#### 网络层提供的两种服务

- 网络层向上只提供简单灵活的、无连接的、尽最大努力交互的数据报服务，并且网络层不提供服务质量的承诺。
- 这样的好处在于网络造价大大降低，运行方式灵活。


#### 网际协议IP

- 网际协议IP是TCP/IP体系中两个最主要的协议之一。其中，与IP协议配套使用的有三种协议：
  - 地址解析协议ARP
  - 网际控制报文协议ICMP
  - 网际组管理协议IGMP
- 
  其中，ICMP、IGMP协议是往基层向上提供的两种服务

#### 互联网络

- 因为用户的需求是多种多样的，没有一种单一的网络能够适应所有用户的需求,所以不同的网络之间，将网络互联起来需要使用一些中间设备。
  - 物理层使用的中间设备是转发器
  - 数据链路层使用的中间设备是网桥或者桥接器
  - 网络层使用的中间设备是路由器
  - 网络层以上使用的中间设备叫网关

##### IP地址与硬件地址

- 物理地址是数据链路层和物理层使用的地址，而IP地址是网络层和网络层以上各层使用的地址

- 在发送数据时，数据从高层下到底层，然后才到通信链路上使用IP的IP数据报一旦交给了数据链路层，就被封装成MAC帧（MAC地址）

##### 地址解析协议ARP

- 已知一个机器的IP地址，如何找出其所对应的硬件地址呢？这就是ARP的主要任务。

  - ARP协议的主要内容在于从网络层使用的IP地址，解析出在数据链路层使用的硬件地址。


  - 工作原理：一个主机都设有一个ARP高速缓存，里面有所在的局域网上的各主机和路由器的 IP 地址到硬件地址的映射表。如果所要找的主机和源主机不在同一个局域网上，那么就要通过 ARP 找到一个位于本局域网上的某个路由器的硬件地址，然后把分组发送给这个路由器，让这个路由器把分组转发给下一个网络。

#### IP数据报

- 
  一个IP数据报由首部（20 字节+可选字段）和数据两部分组成


#### 划分子网和构建超网

- 两级IP到三级IP

  - 两级IP（<网络号>，<主机号>）的缺陷：

  - IP地址的空间利用率有时很低

    - 两级IP地址不够灵活
  - 给每一个物理网络分配一个网络号会使路由表变得太大而使网络性能变坏。

  - 三级IP地址：将其中二级IP的主机号取出并高x位变成子网络，形成网络号+子网号+主机号的地址格式

  - 划分子网：划分子网属于一个单位内部的事情，它将二级IP地址变为三级IP地址


#### 无分类编制CIDR

- CIDR取消了传统的A类、B类和C类地址以及划分子网的概念，并且用网络前缀代替网络号和子网号，后面的部分指明主机。因此，CIDR使IP地址从三级地址(使用子网掩码)，又回到了两级地址（无分类的两级编址）。
- CIDR把网络前缀相同的连续的IP地址组成一个”CIDR地址块”只要知道CIDR地址块中的任何一个地址，就可以知道这地址块的起始地址(即最小地址)和最大地址，以及地址块中的地址数。具体看如下例子

- 
  地址掩码：是一连串的1和0组成，而1的个数救赎网络前缀长度。在斜线记法中。斜线后面的数字就是地址掩码中1的个数。

- 构成超网：由于一个CIDR地址块中含有很多地址，所以在路由表中就利用CIDR地址块来查找目标网络，这种地址的聚合常称为路由聚合，也称构成超网。


#### 最长前缀匹配

- 最长前缀匹配之前，使用CIDR时，每个项目由网络前缀和下一跳地址组成。但是在查找路由表时会得到不止一个匹配结果该怎么办呢？

- 此时应该选择匹配结果中，有最长网络前缀的路由。因为网络前缀越长，可分配的地址数就越少，其地址信息路由就越具体


#### 网际控制报文协议ICMP

- 为了更有效地转发IP数据报和提高交付成功的机会，在网际层使用了ICMP，ICMP允许主机或路由器报告差错情况和提供有关异常情况的报告。ICMP是互联网的标准协议，但不是高层协议。其种类如下：

  - ICMP差错报告报文


  - ICMP询问报文

- ICMP的应用在于分组网间探测PING，以用来测试两台主机之间的连通性。

#### 互联网的路由选择协议

- 路由选择协议分为两大类：

  - 内部网关协议


  - 外部网关协议

- 内部网关协议

  - RIP是内部网关协议中最先得到广泛应用的协议，也被称为路由信息协议，但是其很少被使用。其主要特点如下：
    - 仅和相邻路由器交换信息。
    - 路由器交换的信息是当前路由器所知道的全部信息，即自己现在的路由
    - 按固定的时间间隔交换路由信息，例如，每隔30秒。
    - 因此，RIP有如下的优缺点。
    - 当网络出现故障时，要经过比较长的时间才能将此信息传送到所有的路由器。
    - RIP 协议最大的优点就是实现简单，开销较小。
    - RIP 限制了网络的规模，它能使用的最大距离为 15（16 表示不可达）。
    - 路由器之间交换的路由信息是路由器中的完整路由表，因而随着网络规模的扩大，开销也就增加。

- OSPF最主要的特征就是使用分布式的链路状态协议，其主要特点：

  - 使用洪泛法向本自治系统中所有路由器发送信息。


  - 发送的信息是与本路由器相邻的所有路由器的链路状态。

  - 只有当链路状态发生变化时，路由器才用洪泛法向所有路由器发送此信息。

#### IPv6

- 解决IP地址耗尽的根本措施在于采用具有更大地址空间的新版本IP，即IPv6。它有两大部分组成：基本首部，有效载荷
- IPv6采用的是点分十六进制的记法，把每个十六位的值用十六进制表示，并且各个值之间用冒号分割
- 冒号十六进制允许零压缩，但只能使用一次零压缩
- 冒号十六进制可以结合使用点分十进制记法的后缀。

### 传输层

#### 运输层协议概述

- 运输层功能
  - 运输层应用进程之间提供端到端的逻辑通信。这与网络层的区别在于网络层是为主机之间提供逻辑通信的
  - 运输层需要对收到的报文进行差错检验
  - 运输层有两种不同的运输协议，即面向连接的TCP和无连接的UDP
- TCP/IP的运输层有两个不同的协议：
  - 用户数据报协议UDP
  - 传输控制协议TCP
- UDP协议特点
  - 提供无连接服务
  - 尽最大努力交付
  - 面向报文，UDP 一次交付一个完整的报文
  - 没有拥塞控制，网络拥塞不会使源主机的发送速率降低
  - 支持一对一、一对多、多对一和多对多的交互通信
  - 首部开销小，只有 8 个字节
  - 应用：对可靠性要求不高，需要传送的数据不多，使用频率不高。并且可以实时应用。
- TCP协议特点
  - 提供面向连接的服务
  - 可靠传输：主要以字节为单位的滑动窗口和超时重传时间的选择
  - 面向字节流
  - 拥塞控制：避免由于对网络中某资源的需求超过可用资源，令网络的性能变坏
  - TCP 的流量控制：让发送方的发送速率不要太快
  - 总结：TCP和UDP协议的区别
- TCP的特点
  - 面向连接协议
  - 提供交互保证
  - 较UDP实时性低
  - TCP首部开销20个字节
  - TCP速度较慢
  - 拥塞机制
  - TCP将数据看成一连串的字节
  - 重量级协议，资源占用多
  - 只有点对点连接
- UDP的特点
  - 无连接协议
  - 尽最大努力交付，不提供有序、序列保证
  - 较好的实时性
  - 首部开销8字节
  - 运行速度较快
  - 无拥塞机制
  - 面向报文
  - 轻量级
  - 一对一，一对多，多对多
- 运输层的端口
  - 运行在计算机中的进程是用进程标识符来标志的。但运行在应用层的各种应用进程却不应当让计算机操作系统指派它的进程标识符。这是因为在互联网上使用的计算机的操作系统种类很多，而不同的操作系统又使用不同格式的进程标识符。
    为了使运行不同操作系统的计算机的应用进程能够互相通信，就必须用统一的方法对 TCP/IP 体系的应用进程进行标志。
  - 由于进程的创建和撤销都是动态的，发送方几乎无法识别其他机器上的进程。有时我们会改换接收报文的进程，但并不需要通知所有发送方。所以我们往往需要利用目的主机提供的功能来识别终点，而不需要知道实现这个功能的进程。
  - 解决这个问题的方法就是在运输层使用协议端口号 (protocol port number)，或通常简称为端口(port)。虽然通信的终点是应用进程，但我们可以把端口想象是通信的终点，因为我们只要把要传送的报文交到目的主机的某一个合适的目的端口，剩下的工作（即最后交付目的进程）就由 TCP来完成。

#### TCP可靠传输的实现

- 以字节单位的滑动窗口

  - TCP使用流水线传输和滑动窗口协议实现高效、可靠的传输。TCP 的滑动窗口是以字节为单位的。

  - 发送方 A 和接收方 B 分别维持一个发送窗口和一个接收窗口。


  - 发送窗口表示：在没有收到确认的情况下，可以连续把窗口内的数据全部发送出去。


  - 接收窗口表示：只允许接收落入窗口内的数据。


- 超时重传时间的选择

  - 重传机制是 TCP 中最重要和最复杂的问题之一。
  - TCP 每发送一个报文段，就对这个报文段设置一次计时器。
  - 只要计时器设置的重传时间到但还没有收到确认，就要重传这一报文段。
  - 重传时间的选择是 TCP 最复杂的问题之一。
- 利用滑动窗口实现流量控制
  - 一般说来，我们总是希望数据传输得更快一些。但如果发送方把数据发送得过快，接收方就可能来不及接收，这就会造成数据的丢失。
  - 流量控制 (flow control) 就是让发送方的发送速率不要太快，既要让接收方来得及接收，也不要使网络发生拥塞。
  - 利用滑动窗口机制可以很方便地在 TCP 连接上实现流量控制。

- 拥塞机制

  - 在某段时间，若对网络中某资源的需求超过了该资源所能提供的可用部分，网络的性能就要变坏。这种现象称为拥塞 (congestion)。
  - 最坏结果：系统崩溃。

- 网络拥塞往往是由许多因素引起的。例如：

  - 点缓存的容量太小；
  - 链路的容量不足；
  - 处理机处理的速率太慢；
  - 拥塞本身会进一步加剧拥塞；
  - 总的来说，出现拥塞的原因在于对资源的需求大于可用资源

- TCP的拥塞控制方法

  - 慢开始与拥塞窗口

    - TCP 采用基于窗口的方法进行拥塞控制。该方法属于闭环控制方法。
    - TCP发送方维持一个拥塞窗口 cwnd
    - 发送端利用拥塞窗口根据网络的拥塞情况调整发送的数据量。

    - 发送窗口大小不仅取决于接收方窗口，还取决于网络的拥塞状况
    - 只要网络没有出现拥塞，拥塞窗口就可以再增大一些，以便把更多的分组发送出去，这样就可以提高网络的利用率。
    - 但只要网络出现拥塞或有可能出现拥塞，就必须把拥塞窗口减小一些，以减少注入到网络中的分组数，以便缓解网络出现的拥塞。
    - 其中，对于拥塞的判断，有以下两个指标：1.重传定时器超时。2.收到三个重复的ACK。

### 应用层协议

- 应用层协议主要定义运行在不同端系统上的应用程序进程之间如何相互传递信息
- 常用的几种协议：DNS、FTP、HTTP、DHCP 的作用

  - DNS：域名系统DNS是互联网使用的命名系统，用来把便于人们使用的机器名字转换为IP地址。DNS同时占用TCP协议与UDP协议的53号端口。
  - FTP：文件传送协议FTP是互联网上使用的最广泛的文件传送协议。FTP使用的传输层协议是
  - TCP，FTP 传数据流占用20号端口，FTP传控制流占用21号端口。
  - HTTP：HTTP协议定义了浏览器怎样向万维网服务器请求万维网文档，以及服务器怎样把文档传送给浏览器。HTTP使用传输层协议为TCP，端口号为80。
  - DHCP：互联网目前广泛使用的动态主机配置协议DHCP，它提供一种机制，成为即插即用联网。DHCP使用UDP，端口号为67和68。

- 在应用层，用到DNS协议，作用是域名解析，HTTP协议浏览器和服务器之间的交互访问协议。
- 在传输层，运用UDP域名解析协议使用的运输层协议，TCP浏览器和WWW服务器之间建立连接，提供可靠的数据传输。
- 在网际层IP，IP数据报传输和路由选择，ICMP提供网络传输中的差错检测，ARP将本机缺省的网关IP地址映射成物理地址（MAC地址）。

