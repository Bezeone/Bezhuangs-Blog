---
title: 计算机组成原理（下）
date: 2021-10-12
updated: 2021-11-27
tags: []
references:
  - title: 考研408计算机组成原理知识点整理汇总
    url: https://blog.csdn.net/weixin_43509127/article/details/107624174
categories: 计算机专业
---

> 计算机组成原理是计算机专业本科教学中的重要课程，它可以帮助我们系统地理解计算机硬件系统的组织结构和工作原理、掌握计算机硬件系统的基本分析与设计方法以及建立计算机系统的整体概念，为进一步学习计算机设计实践课程、培养系统开发、调试以及设计创新能力奠定良好的基础。计组是考研的最重最难点，在408计算机学科专业基础综合考试中占有45分。我选择的课程是哈工大的[国家精品课](https://www.icourse163.org/course/hit-309001)，配合天勤高分笔记，以下为所记课堂笔记下半部分，包含CPU、总线和I/O系统的知识点，可供参考。上半部分笔记请访问[计算机组成原理（上）](/计算机组成原理-上)

<!--more-->

### 中央处理器

#### 计算机工作过程

- 加电——》产生reset信号——》执行程序——》停机——》停电
- 产生reset信号的任务
  - 任务一：使计算机处于初始状态
  - 任务二：从PC中取出指令地址
- 控制器作用是协调并控制计算机各部件执行程序的指令序列

#### 控制器的组成

- 控制器的功能
  - 取指令：发出指令地址，取出指令的内容
- 分析指令
  - 对操作码译码产生操作相应部件的控制信号
  - 根据寻址方式形成操作数地址
- 执行指令
  - 根据分析指令后产生控制信号、操作数地址信号序列，通过CPU及输入输出设备的执行实现每条指令的功能
  - 结果回送存储器
  - 形成下条指令的地址
- 控制程序和数据的输入和结果输出
- 对异常情况和某些请求的处理
  - 异常情况的处理：例如算术运算的溢出、数据传送奇偶错
  - 某些请求的处理
  - “中断请求”信号
  - DMA请求信号
- 控制器的组成
  - 程序计数器（PC）：即地址寄存器，用来存放当前正在执行的指令地址或即将要执行的下一条指令地址
  - 指令寄存器（IR）：用以存放当前正在执行的指令，以便在指令执行过程中控制完成一条指令的全部功能
  - 指令译码器或操作码译码器：对指令寄存器中的操作码进行分析解释，产生相应的控制信号
  - 脉冲源及启停线路：脉冲源参数一定评率的脉冲作为整个机器的时钟脉冲，是机器周期和工作脉冲的基准信号，在机器刚加电时，还应产生一个总清信号（reset）
  - 时序控制信号形成部件：当程序启动后，在CLK时钟作用下，根据当前正在执行的指令的需要，产生相应的时序控制信号，并根据被控制功能部件的反馈信号调整时序控制信号
    - 控制存储器
    - 微指令寄存器：控制字段+下址
- 周期概念
  - 指令周期：完成一条指令所需的时间，包括取指令、分析指令、执行指令
  - 机器周期：也称为CPU周期，是CPU从内存中读取一个指令的时间，通常等于取指周期
  - 时钟周期：称为节拍脉冲或T周期，是基准脉冲信号
  - 三条假设
    - 程序是存放在主存中的，当执行完一条指令后才从主存中取下一条指令（非流水线）
    - 指令的长度是固定的，并限制了寻址方式的多样化
    - 在程序运行前，程序和数据都已存在主存中
- 指令执行过程（运算器和控制器配合）
- 组成控制器的基本电路
  - 具有记忆功能的触发器以及由它组成的寄存器，计数器和存储单元
  - 没有记忆功能的门电路及由它组成的加法器，算术逻辑运算单元（ALU）和各种逻辑电路
- 控制器的功能就是按每一条指令的要求产生所需的控制信号
- 产生控制信号的方法
  - 微程序控制
  - 硬布线控制

#### 微程序控制计算机的基本工作原理

- 微指令：在微程序控制的计算机中，将由同时发出的控制信号所执行的一组微操作
- 微命令：将指令分为若干条微指令，按次序执行这些微指令。组成微指令的操作即微命令
- 微程序：计算机的程序由指令序列构成，而计算机每条指令的功能均由微指令序列解释完成，这些微指令序列的集合就叫做微程序
- 控制存储器
  - 微程序一般是存放在专门的存储器中的，由于该存储器主要存放控制命令（信号）与下一条执行的微指令地址（简称下址）
  - 存储单元内容
    - 微指令的控制信号——控制位
    - 下条微指令的地址——下址字段
  - 存储芯片：ROM
- 执行一条指令实际上就是执行一段存放在控制存储器中的微程序
- 实现微程序控制的基本原理
  - 控制信号（23条）
  - 加法的过程
  - 微指令格式：控制字段+下址字段
  - 23个控制位，12个下址位——》容量为4K
  - 取址微指令的操作对所有指令都是相同的，所以是一条公用的微指令，其下址由操作码译码产生
- 微程序控制器
- 时序信号及工作脉冲的形成
- 停机和停电的区别
- 停机：电压稳定、存放内容保持、重启PC内容为断点指令地址
- 停电：电压消失、RAM的内容消失、重启PC内容为第一条指令地址

#### 微程序设计技术

- 如何缩短微指令字长
  - 直接控制法（容量太小）
    - 编译方法：每一位代表一个控制信号，直接送往相应的控制点
    - 优点：控制简单
    - 缺点：微指令字长过大
  - 字段直接编译法
    - 选出互斥的微指令
    - 每个字段都要留出一个代码，表示本段不发出任何指令（000）
    - 优点：节省微指令的字长
    - 缺点：增加了额外的硬件开销
  - 字段间接编译法
    - 指令之间相互联系的情况
    - 举例：A为0-7，B为0-3，如果是直接编译——3+2=5，如果是间接编译——3+1=4
    - 编码方法：在字段直接编译法中，译码输出端要兼由另一字段中的某些微命令配合解释
    - 优点：减少了微指令长度
    - 缺点：可能削弱微指令的并行控制能力，同时增加硬件开销
  - 常熟源字段E
- 如何减少微指令长度
  - 现行微指令/微地址
    - 现行微指令：当前正在执行的指令
    - 现行微地址：存放现行微指令的控制器存储单元
  - 后继微指令/微地址
    - 后继微指令：下一条要执行的微指令
    - 后继微地址：存放后继微指令的控制器存储单元
  - 增量与下址字段结合产生后继微指令的方法
    - 下址字段分成：转移控制字段BCF和转移地址字段BAF
      - BCF：控制微程序的转移情况
      - BAF：转移后的微指令所在地址
    - BAF有两种情况
      - 与uPC的位数相等——转移灵活，但增加微指令长度
      - 比uPC短——转移地址收到限制，但可缩短微指令长度
    - 优点：微指令的下址字段很短，仅用于选择输入uPC计数器的某条线路有效
    - 缺点：微程序转移不灵活，使得微程序在控存中的物理空间分配有困难
  - 多路转移方式：一条微指令存在多个转移分支的情况称为多路转移
  - 微中断
    - 微中断请求信号是由程序中断请求信号引起的
    - 在完成现行指令的微程序后响应该微中断请求
    - 由硬件产生对应微中断处理程序在控存中的入口地址
- 如何提高微程序的执行速度
  - 微指令格式
  - 水平型微指令——直接控制，字段编译（直接、间接）
    - 特点：在一条微指令中定义并并行执行多个微命令
  - 垂直型微指令
    - 特点：不强调实现微指令的并行控制功能
    - 定义：采用微操作码编译法，由操作码规定微指令的功能
  - 微程序控制存储器
    - 一般采用ROM存储器
    - 也可采用RAM，为防止断电后内容消失，则必须开机后将外存中存放的微程序调入控存RAM，然后才能执行程序。
    - 当前为了能不断扩展指令系统，通常采用ROM+RAM
  - 动态微程序设计
    - 定义：能根据用户要求改变微程序
    - 优点：是计算机能更灵活、有效的适应于各种不同的应用目标
  - 控制存储器的操作
    - 串行方式
    - 并行方式——比串行多了微指令寄存器
    - 微周期=max(取微指令时间,执行微指令时间)
    - 由于取微指令、执行微指令同时进行，故对于某些后继微地址的产生根据处理结果而定的微指令，则延迟一个微周期再取微指令

#### 硬布线控制的计算机（RISC）——特点快

- 形成操作控制信号的逻辑框图
- 操作控制信号的产生
  - 取值周期cy1所产生的信号对所有指令都是相同的，即与当前执行的指令无关，逻辑式得到最简单的形式
  - 通常，同一个控制控制信号在若干条指令的某些周期（或再加上一些条件）中都需要，为此需要把它们组合起来
  - 同种类型的指令所需要的控制信号大部分是相同的，仅有少量区别
  - 在确定指令的操作码时（即对具体指令赋予二进制操作码），为了便于逻辑表达式的化简以减少逻辑电路数量，往往给予特别关注
- 设计组合逻辑电路从而产生需要的控制信号的步骤
  1. 实际逻辑问题
  2. 真值表
  3. 公式化简
  4. 逻辑电路图
- 设计目标：使用最少的电路元件达到最高的操作速度

#### 流水线工作原理

- 每条指令的执行时间不变
- 每条指令处理结果的时间缩短
- 流水线处理速率最高时=流水线处于满载的稳定状态
- 流水线处理速率最低时=流水线未满载状态
- 为了满足在重叠时间段不同指令的机器周期能够完成指定的操作，将时间段=操作完成的最长时间
- 为了保证一个周期内流水线的输入信号不变，相邻时间段之间必须设置锁存器或寄存器
- 除了指令执行流水线，还有运算操作流水线
- 流水线阻塞
  - 数据相关产生
  - 假设第二条指令需要的操作数是第一条指令运算的结果，那么出现了数据相关
  - 指令执行时间不同产生
  - 程序转移的影响
  - 异常情况响应中断

### 存储系统

#### 存储系统的层次结构

- cache->主存->辅存

#### 高速缓冲存储器

- cache的工作原理
  - 局部性原理
  - 主存地址和cache地址（P166 图7.2）
  - 块长：块长一般取一个主存周期所能调出的信息长度（一般为16个字）
  - cache的容量和块的大小是影响cache的效率的重要因素
  - 命中率：CPU所要访问的信息是否在cache中的比率，而将所要访问的信息不在cache中的比率称为失败率
  - 一致性策略
    - 标志交换方式（写回法）
    - 通过式写入（写通法）
    - 写操作直接对主存进行，而不写入cache
  - cache的平均存取时间=h*tc+(1-h)(tc+tm)
  - 最好替换策略：按照被替换的字块是下一段时间最少使用的，由替换部件实现
- cache组织地址映像
  - 直接映像
    - cache中许多空的位置被浪费
    - 主存地址：主存字块标记+cache字块地址+字块内地址
  - 全相联映像
    - 成本太高而不能采用
    - 主存地址：主存字块标记+字块内地址
    - 优点
    - 方式灵活，缩小了块发生冲突的概率
    - 缺点
    - 增加了标识位位数
    - 增加了寻找主存块在cache中对应块的时间
  - 组相联映像
    - 直接映像和全相联映像的折衷
    - 主存地址：主存字块标记+组地址+块内地址

#### 虚拟存储器

- 存储管理部件（MMU）
- 现代计算机一般都有辅助存储器，但具有辅存的存储系统不一定是虚拟存储系统
- 虚拟存储系统的特点
  - 允许用户程序用比主存大的多的空间来访问主存
  - 每次访存都要进行虚实地址的转换

### 辅助存储器

- 半导体存储器可随机访问任一单元，而辅助存储器一般为串行访问存储器

#### 辅助存储器的种类

- 磁表面存储器
  - 数字式磁记录：硬盘、软盘和磁带
  - 模拟式磁记录：录音、录像设备
- 光存储器：光盘

##### 串行存储器

- 顺序存取存储器
- 直接存取存储器

##### 辅助存储器的技术指标

- 存储密度：单位长度或单位面积磁层表面磁层所存储的二进制信息量
- 道密度：沿磁盘半径方向单位长度的磁道数称为道密度，单位为道/英寸tpi或道/毫米tpmm
- 位密度或线密度：单位长度磁道所能记录二进制信息的位数叫位密度或线密度，单位为位/英寸bpi或位/毫米bpmm
- 每个磁道所存储的信息量是一样的
- 存储容量：C = n × k × s
- 寻址时间：平均寻址时间Ta=平均找道时间Ts+平均等待时间Tw
- 数据传输率：Dr = D × V
- 误码率
- 价格

#### 硬磁盘存储器的类型

- 固定磁头和移动磁头
- 可换盘和固定盘

#### 磁盘存储器

- 温彻斯特磁盘简称温盘
- 磁盘存储器由驱动器（HDD），控制器（HDC）和盘片组成
- 最外面的同心圆叫0磁道，最里面的同心圆假设称为n磁道
- 驱动器的定位驱动系统实现快速精准的磁头定位
- 主轴系统的作用是带动盘片按额定转速稳定旋转
- 数据控制系统的作用是控制数据的写入和读出，包括寻址，磁头旋转，写电流控制，读出放大，数据分离
- 磁盘控制器有两个方向的接口
  - 与主机的接口
  - 与驱动器（设备）的接口

#### 光盘

- 采用光存储技术
- 利用激光写入和读出
- 第一代光存储技术采用非磁性介质，不可擦写
- 第二代光存储技术，采用磁性介质，可擦写
- 光盘的存储原理
  - 只读型和只写一次型：热作用（物理或化学变化）
  - 可擦写光盘：热磁效应

### 输出输出（I/O）设备/系统

#### 设备控制器（I/O）的基本功能

- 实现主机和外部设备之间的数据传送
- 实现数据缓冲，以达到主机同外部设备之间的速度匹配
- 接受主机的命令，提供设备接口的设备，并按照主机的命令控制设备

#### I/O 编址方式

- 统一编址：用取数、存数指令
- 不统一编址：有专门的 I/O 指令

#### I/O 与主机的连接方式

- 辐射式连接
  - 每台设备都配有一套
  - 控制线路和一组信号线
  - 不便于增删设备
- 总线连接
  - 便于增删设备

#### I/O设备

- 人机交互设备：键盘、鼠标等
- 计算机信息的驻留设备：硬盘、光盘等
- 机——机通信设备：MODEN等

#### 为什么要设置接口？

- 实现设备的选择
- 实现数据缓冲达到速度匹配
- 实现数据串 并格式转换
- 实现电平转换
- 传送控制命令
- 反映设备的状态（“忙”、“就绪”、“中断请求”）

#### 中断服务程序的流程

- 保护现场
  - 程序断点的保护
  - 寄存器内容的保护
- 中断服务
  - 对不同的 I/O 设备具有不同内容的设备服务
- 恢复现场：出栈指令
- 中断返回：中断返回指令

#### 单重中断和多重中断

- 单重中断：不允许中断 现行的 中断服务程序
- 多重中断：允许级别更高 的中断源（现行的 中断服务程序）

#### DMA 方式

- 主存和 I/O 之间有一条直接数据通道
- CPU 和 I/O 并行工作
- DMA 的三种工作方式
  - CPU暂停方式
  - CPU周期窃取方式
  - 直接访问存储器
- DMA 接口功能
  - 向 CPU 申请 DMA 传送
  - 处理总线 控制权的转交
  - 管理 系统总线、控制 数据传送
  - 确定 数据传送的 首地址和长度，修正 传送过程中的数据地址和长度
  - DMA 传送结束时，给出操作完成信号
- DMA 传送过程：预处理、数据传送、后处理

#### 外设接口

- 设备与主机相连时，必须按照规定的物理互连特性、电气特性等进行连接，这些特性的技术规范称为接口标准