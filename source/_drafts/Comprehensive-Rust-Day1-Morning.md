---
title: Comprehensive Rust 第一天上午
date: 2023-04-05
tags: []
categories: Rust
references:
  - title: Comprehensive Rust
    url: https://google.github.io/comprehensive-rust/
---

> 作为一门现代化的系统编程语言，Rust 具有内存安全、并发安全、高效等特点，在诸多领域都有广泛的应用。同时作为一种开源语言，Rust 主要由 Mozilla 团队和许多开源社区成员共同维护和开发，它的开源社区也非常活跃，不断推出新的工具和库，以提高 Rust 的开发效率和开发体验。Comprehensive Rust 是由谷歌 Android 团队开发的为期四天的 Rust 课程。课程涵盖基本语法到泛型等高级主题和错误处理，希望在学习完后能全面了解 Rust 语法和语言，能够在 Rust 中修改现有程序和编写新程序。以下是我在第一天上午的学习和实战过程中的整理总结。
>

<!--more-->

### 一、什么是 Rust

Rust 是一种新的静态类型编译语言，适用领域与 C++ 类似，拥用高灵活性、高水平的可控，没有运行时（Runtime）和垃圾回收（Garbage Collector），注重可靠性和安全性，同时不牺牲性能。

Rust 支持许多[平台和架构](https://doc.rust-lang.org/nightly/rustc/platform-support.html)：x86， ARM， WebAssembly，Linux， Mac， Windows 等，也能够用于各种设备：固件和引导程序、智能显示设备、手机、桌面、服务器。

`rustc` 是 Rust 编程语言的编译器，使用 LLVM 作为其后端。编译器将源代码和生产二进制代码，变成一个或可执行文件。

### 二、你好，世界

Rust 非常像 C/C++/Java 那样传统中的其他语言。它是命令式的（而不是函数式的），除非绝对必要，否则它不会试图重新发明东西。

Rust 函数是用 `fn` 引入的，像 C 和 C++ 中一样，区块由大括号来划分，主函数是程序的入口点。

Rust使用宏来处理那些你想拥有可变数量的参数的情况（没有函数重载）。宏的 "卫生性 "意味着它们不会意外地从它们所使用的范围中捕获标识符，`println！` 就是其中的一个例子。

Rust 的字符串是 UTF-8 编码的，可以包含任何 Unicode 字符。

```rust
fn main() {
    println!("Hello 🌍!");
}
```

下面这段 Rust 代码实现了科拉茨猜想：

```rust
fn main() {              // Program entry point
    let mut x: i32 = 6;  // Mutable variable binding
    print!("{x}");       // Macro for printing, like printf
    while x != 1 {       // No parenthesis around expression
        if x % 2 == 0 {  // Math like in other languages
            x = x / 2;
        } else {
            x = 3 * x + 1;
        }
        print!(" -> {x}");
    }
    println!();
}
```

### 三、为什么选择 Rust

相对于 C 或 C++ ，Rust 通过借用检查器消除了一整类运行时错误。Rust 可以拥用在 C 和 C++ 中一样的性能，且没有内存不安全问题。此外，Rust 还有现代语言模式匹配和内置依赖项管理等构造。

相对于 Java，Go，Python，JavaScript...，Rust 可以拥用在那些语言中一样相同的内存安全性，加上类似的高级语言感觉。另外 Rust 可以获得像 C 和 C++ 那样快速且可预测的性能，例如没有垃圾回收器， 以及可访问低级硬件（如果需要）。

Rust 在编译的时候保证静态内存管理：没有未初始化的变量，大多数情况下没有内存泄漏，没有双重释放和释放后不使用，没有指针 和 `NULL` ，没有忘记锁定的互斥锁，线程之间没有数据争用，没有迭代器失效。

Rust 在运行的时候保证在运行时没有未定义的行为：数组访问是有边界检查的，定义了整数溢出。

Rust 是用过去 40 年获得的所有经验构建的，拥用枚举和模式匹配、泛型、无开销 FFI、零成本抽象等语言特性。也拥有很棒的编译器错误输出，内置依赖项管理器，内置测试支持，以及出色的语言服务器协议支持。

与 Java，Python，Go 等语言相比，Rust 标准库很小。但 Rust 带有一个内置的 Cargo 形式的包管理器，可以轻松下载和编译第三方 crates（包），像 https://lib.rs/ 这样的网站可以帮助你找到好的、值得信赖的依赖包。

### 四、基本语法

Rust 中一些语法和 C、C++ 或 Java 相似：块和作用域由大括号 `{}` 分隔。行注释以 `//` 开头，块注释由 `/* ... */` 分隔。关键字 `if`、`while` 的工作方式相同。变量赋值用 `=` 完成，比较用 `==` 完成。

#### 基本数据类型

|              | 类型                                      | 文字                         |
| ------------ | ----------------------------------------- | ---------------------------- |
| 有符号整数   | `i8`, , , , ,`i16``i32``i64``i128``isize` | `-10`, , ,`0``1_000``123i64` |
| 无符号整数   | `u8`, , , , ,`u16``u32``u64``u128``usize` | `0`, ,`123``10u16`           |
| 浮点数       | `f32`,`f64`                               | `3.14`, ,`-10.0e20``2f32`    |
| 字符串       | `&str`                                    | `"foo"`,`r#"\\"#`            |
| 统一码标量值 | `char`                                    | `'a'`, ,`'α'``'∞'`           |
| 字节字符串   | `&[u8]`                                   | `b"abc"`,`br#" " "#`         |
| 布尔 值      | `bool`                                    | `true`,`false`               |

这些类型的宽度如下：`iN`、 `uN` 和 `fN` 是 *N* 位宽，`isize` 和 `usize` 和指针的宽度一样，`char`为 32 位宽，`bool`为 8 位宽。

#### 复杂数据类型

|      | 类型                          | 文字                              |
| ---- | ----------------------------- | --------------------------------- |
| 数组 | `[T; N]`                      | `[20, 30, 40]`,`[0; 3]`           |
| 元组 | `()`, , , ...`(T,)``(T1, T2)` | `()`, , , ...`('x',)``('x', 1.2)` |

数组分配和访问：

```rust
fn main() {
    let mut a: [i8; 10] = [42; 10];
    a[5] = 0;
    println!("a: {:?}", a);
}
```

元组分配和访问：

```rust
fn main() {
    let t: (i8, bool) = (7, true);
    println!("1st index: {}", t.0);
    println!("2nd index: {}", t.1);
}
```

